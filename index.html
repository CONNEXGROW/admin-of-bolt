<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Appointments</title>
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAkDl3ckFSXDHlZpyR0s7IZ1UTSX8Z6hSY",
            authDomain: "bolt-54408.firebaseapp.com",
            projectId: "bolt-54408",
            storageBucket: "bolt-54408.firebasestorage.app",
            messagingSenderId: "88291790006",
            appId: "1:88291790006:web:259387f2de1d7b164eaa17",
            measurementId: "G-6YD4D3514J",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // Google Login Function
        window.login = function() {
            signInWithPopup(auth, provider)
                .then((result) => {
                    const user = result.user;
                    checkAccess(user);
                })
                .catch((error) => {
                    console.error("Login Failed:", error);
                    alert("Login failed. Please try again.");
                });
        }

        // Logout Function
        window.logout = function() {
            signOut(auth).then(() => {
                alert("Logged out successfully.");
                document.getElementById("loginSection").style.display = "block";
                document.getElementById("adminSection").style.display = "none";
            }).catch((error) => {
                console.error("Logout Error:", error);
            });
        }

        // Function to Fetch and Display Appointments
        async function loadAppointments() {
            const querySnapshot = await getDocs(collection(db, "appointments"));
            let tableBody = document.getElementById("appointmentTableBody");

            tableBody.innerHTML = ""; // Clear existing data

            querySnapshot.forEach((doc) => {
                let data = doc.data();
                let row = `
                    <tr>
                        <td>${data.name}</td>
                        <td>${data.email}</td>
                        <td>${data.date}</td>
                        <td>${data.time}</td>
                        <td>${data.phone}</td>
                        <td>${data.message}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // Check if the logged-in user is authorized
        function checkAccess(user) {
            if (user.email === "advertisingbolt1@gmail.com") {
                document.getElementById("loginSection").style.display = "none";
                document.getElementById("adminSection").style.display = "block";
                loadAppointments();
            } else {
                alert("Access Denied! Only authorized users can view this page.");
                logout();
            }
        }

        // Listen for Auth State Changes
        onAuthStateChanged(auth, (user) => {
            if (user) {
                checkAccess(user);
            } else {
                document.getElementById("loginSection").style.display = "block";
                document.getElementById("adminSection").style.display = "none";
            }
        });
    </script>
</head>
<body>
    <!-- Login Section -->
    <div id="loginSection" style="text-align: center;">
        <h2>Admin Panel Login</h2>
        <button onclick="login()">Login with Google</button>
    </div>

    <!-- Admin Panel Section -->
    <div id="adminSection" style="display: none;">
        <h2>Appointments</h2>
        <button onclick="logout()">Logout</button>
        <table border="1">
            <thead>
                <tr>
                    <th>Your Name</th>
                    <th>Your Email</th>
                    <th>Appointment Date</th>
                    <th>Appointment Time</th>
                    <th>Phone Number</th>
                    <th>Message</th>
                </tr>
            </thead>
            <tbody id="appointmentTableBody">
                <!-- Data will be inserted here -->
            </tbody>
        </table>
    </div>
</body>
</html>
