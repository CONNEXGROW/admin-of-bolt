<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Appointments</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo="> <!-- Fix favicon error -->
</head>
<body>

    <!-- Login Section -->
    <div id="loginSection" style="text-align: center;">
        <h2>Admin Panel Login</h2>
        <button id="loginBtn">Login with Google</button>
    </div>

    <!-- Admin Panel Section -->
    <div id="adminSection" style="display: none;">
        <h2>Appointments</h2>
        <button id="logoutBtn">Logout</button>
        <table border="1">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Appointment Date</th>
                    <th>Appointment Time</th>
                    <th>Phone Number</th>
                    <th>Message</th>
                </tr>
            </thead>
            <tbody id="appointmentTableBody"></tbody>
        </table>
    </div>

    <!-- Firebase Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ✅ Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAkDl3ckFSXDHlZpyR0s7IZ1UTSX8Z6hSY",
            authDomain: "bolt-54408.firebaseapp.com",
            projectId: "bolt-54408",
            storageBucket: "bolt-54408.firebasestorage.app",
            messagingSenderId: "88291790006",
            appId: "1:88291790006:web:259387f2de1d7b164eaa17",
            measurementId: "G-6YD4D3514J",
        };

        // ✅ Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // ✅ Google Login Function
        document.getElementById("loginBtn").addEventListener("click", () => {
            signInWithPopup(auth, provider)
                .then((result) => {
                    checkAccess(result.user);
                })
                .catch((error) => {
                    console.error("Login Failed:", error.message);
                    alert("Login Failed! Please try again.");
                });
        });

        // ✅ Logout Function
        document.getElementById("logoutBtn").addEventListener("click", () => {
            signOut(auth).then(() => {
                alert("Logged out successfully.");
                showLogin();
            }).catch((error) => {
                console.error("Logout Error:", error);
            });
        });

        // ✅ Check User Access
        function checkAccess(user) {
            if (user.email === "advertisingbolt1@gmail.com") {
                showAdminPanel();
                loadAppointments();
            } else {
                alert("Access Denied! Only authorized users can view this page.");
                signOut(auth);
                showLogin();
            }
        }

        // ✅ Load Firestore Data
        async function loadAppointments() {
            const querySnapshot = await getDocs(collection(db, "appointments"));
            let tableBody = document.getElementById("appointmentTableBody");

            tableBody.innerHTML = ""; // Clear previous data

            querySnapshot.forEach((doc) => {
                let data = doc.data();
                let row = `
                    <tr>
                        <td>${data.name}</td>
                        <td>${data.email}</td>
                        <td>${data.date}</td>
                        <td>${data.time}</td>
                        <td>${data.phone}</td>
                        <td>${data.message}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // ✅ UI Functions
        function showLogin() {
            document.getElementById("loginSection").style.display = "block";
            document.getElementById("adminSection").style.display = "none";
        }

        function showAdminPanel() {
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("adminSection").style.display = "block";
        }

        // ✅ Detect Auth State
        onAuthStateChanged(auth, (user) => {
            if (user) {
                checkAccess(user);
            } else {
                showLogin();
            }
        });

    </script>

</body>
</html>
